#!/usr/bin/env python3
"""Build script to inline ./prepare_env.py and tool_injection.py into mcp_run_python/deno/prepareEnvCode.ts"""

from pathlib import Path

this_dir = Path(__file__).parent
root_dir = this_dir.parent

# Define source and destination paths
src_dir = root_dir / 'mcp_run_python' / 'deno' / 'src'
prepare_env_src = this_dir / 'prepare_env.py'
tool_injection_src = src_dir / 'tool_injection.py'
dst = src_dir / 'prepareEnvCode.ts'

prepare_env_code = prepare_env_src.read_text()
tool_injection_code = tool_injection_src.read_text()

# Escape backslashes for JavaScript string literal
prepare_env_code = prepare_env_code.replace('\\', '\\\\')
tool_injection_code = tool_injection_code.replace('\\', '\\\\')

# Create the JavaScript/TypeScript code
ts_code = f"""// DO NOT EDIT THIS FILE DIRECTLY, INSTEAD RUN "make build"
export const preparePythonCode = `{prepare_env_code}`

export const toolInjectionCode = `{tool_injection_code}`
"""

dst.write_text(ts_code)

print(f'Successfully built {dst}')
